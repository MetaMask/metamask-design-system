name: PR Template Guard

on:
  pull_request_target:
    types: [opened, edited, reopened, ready_for_review, synchronize]

permissions:
  pull-requests: write
  contents: read

jobs:
  check-template:
    name: Ensure PR description follows template
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR body
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const body = (pr && pr.body) ? pr.body : '';
            const requiredHeadings = [
              '## **Description**',
              '## **Related issues**',
              '## **Manual testing steps**',
              '## **Screenshots/Recordings**',
              '## **Pre-merge author checklist**',
              '## **Pre-merge reviewer checklist**'
            ];
            const missing = requiredHeadings.filter(h => !body.includes(h));
            if (missing.length > 0) {
              core.setFailed(`PR body is missing required sections: ${missing.join(', ')}`);
            }
