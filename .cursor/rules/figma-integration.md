# Figma Code Connect

Connect design system components to Figma for automatic code snippet display in Dev Mode.

**Note:** For initial setup (Figma token, environment configuration), see @docs/figma-code-connect.md

## Critical Rules

### File Location and Naming

- **ALWAYS** colocate `.figma.tsx` files with their components
- **ALWAYS** use naming convention: `ComponentName.figma.tsx`
- **ALWAYS** create Code Connect files for BOTH React and React Native platforms

```
// ✅ Correct file structure
src/components/Button/
├── Button.tsx
├── Button.figma.tsx        ← Code Connect
└── ...
```

### Required File Structure

**ALWAYS** include (in order):

1. ESLint disable comment (first line)
2. Auto-generated comment documenting purpose
3. Imports (actual component and enums)
4. figma.connect() call

```tsx
// eslint-disable-next-line import-x/no-named-as-default
import figma from '@figma/code-connect';
import React from 'react';

import { Button } from './Button';
import { ButtonVariant, ButtonSize } from '.';

/**
 * -- This file was auto-generated by Code Connect --
 * React implementation of Button
 */

figma.connect(
  Button,
  'https://www.figma.com/design/[fileKey]/...?node-id=[nodeId]',
  {
    props: {
      /* Property mappings */
    },
    example: (props) => <Button {...props} />,
  },
);
```

### Critical: Use Enums, Not Strings

```tsx
// ❌ Wrong - String literals
props: {
  variant: figma.enum('variant', {
    Primary: 'primary', // String literal
  });
}

// ✅ Correct - Import and use enum values
import { ButtonVariant } from '.';

props: {
  variant: figma.enum('variant', {
    Primary: ButtonVariant.Primary,
  });
}
```

### Critical: Realistic Example Props

```tsx
// ❌ Wrong - Placeholder values
example: (props) => <AvatarAccount address="0x123" {...props} />;

// ✅ Correct - Realistic values
example: (props) => (
  <AvatarAccount
    address="0x9Cbf7c41B7787F6c621115010D3B044029FE2Ce8"
    {...props}
  />
);
```

## Prop Mapping API Reference

### Common Patterns

```tsx
props: {
  // Enum mapping (most common)
  variant: figma.enum('variant', {
    Primary: ButtonVariant.Primary,
    Secondary: ButtonVariant.Secondary,
  }),

  // Boolean mapping
  isDisabled: figma.boolean('isDisabled'),

  // String mapping
  label: figma.string('label'),

  // Boolean with conditional values
  startIconName: figma.boolean('startIcon (Figma Only)', {
    true: IconName.Add,
    false: undefined,
  }),

  // Nested props (for Figma component structures)
  buttonBase: figma.nestedProps('ButtonBase', {
    size: figma.enum('size', { Sm: ButtonSize.Sm }),
    label: figma.string('label'),
  }),
}
```

## Example Patterns

### Simple Example (Static Props)

For components with minimal required props:

```tsx
example: (props) => (
  <AvatarAccount
    address="0x9Cbf7c41B7787F6c621115010D3B044029FE2Ce8"
    {...props}
  />
);
```

### Complex Example (Destructured Props)

For components with nested props or multiple variants:

```tsx
example: ({
  variant,
  buttonBase,
  isDisabled,
  isLoading,
  loadingText,
  ...props
}) => (
  <Button
    variant={variant}
    size={buttonBase.size}
    isDisabled={isDisabled}
    isLoading={isLoading}
    loadingText={loadingText.text}
    startIconName={buttonBase.startIconName}
    endIconName={buttonBase.endIconName}
    {...props}
  >
    {buttonBase.label}
  </Button>
);
```

### Stateful Example (React Hooks)

For interactive components needing state:

```tsx
import { useState } from 'react';

example: ({ isDisabled, label, ...props }) => {
  const [isSelected, setIsSelected] = useState(false);
  return (
    <Checkbox
      id="checkbox-example"
      isSelected={isSelected}
      isDisabled={isDisabled}
      label={label.text}
      onChange={(prevState) => setIsSelected(!prevState)}
      {...props}
    />
  );
};
```

## Workflow

### Adding Code Connect to New Component

```bash
# 1. Run interactive setup
yarn figma:connect:react              # React Web
yarn figma:connect:react-native       # React Native

# 2. Follow wizard to select/search component in Figma

# 3. Review generated file and update:
#    - Replace string literals with enum values
#    - Add realistic example props
#    - Ensure all required props included

# 4. Validate before publishing
yarn figma:connect:publish:dry-run

# 5. Publish to Figma
yarn figma:connect:publish
```

### Updating Existing Code Connect

```bash
# 1. Update .figma.tsx file manually

# 2. Validate and republish
yarn figma:connect:publish:dry-run
yarn figma:connect:publish
```

### Expected Results in Figma Dev Mode

After successful publishing:

- Platform dropdown shows "React" and "React Native"
- Correct imports displayed (platform-specific packages)
- Code examples show realistic props and enum values

## Commands

```bash
# Interactive setup
yarn figma:connect:react              # React wizard
yarn figma:connect:react-native       # React Native wizard

# Publishing
yarn figma:connect:publish            # Publish all
yarn figma:connect:publish:dry-run    # Validate all
yarn figma:connect:unpublish          # Unpublish all

# Platform-specific
yarn figma:connect:publish:react                  # Publish React only
yarn figma:connect:publish:react-native           # Publish React Native only
yarn figma:connect:publish:react:dry-run          # Validate React
yarn figma:connect:publish:react-native:dry-run   # Validate React Native

yarn figma:connect:unpublish:react           # Unpublish React
yarn figma:connect:unpublish:react-native    # Unpublish React Native
```

## Golden Path Examples

**Complete examples demonstrating best practices:**

- **Simple component**: @packages/design-system-react/src/components/AvatarAccount/AvatarAccount.figma.tsx
- **Complex component**: @packages/design-system-react/src/components/Button/Button.figma.tsx
- **Stateful component**: @packages/design-system-react/src/components/Checkbox/Checkbox.figma.tsx
- **React Native example**: @packages/design-system-react-native/src/components/Button/Button.figma.tsx

These show:

- Proper eslint disable comment
- Auto-generated comment
- Enum value usage (not strings)
- Realistic example props
- Nested props handling
- Stateful examples with hooks

**Configuration files:**

- @packages/design-system-react/figma.config.json (React Web)
- @packages/design-system-react-native/figma.config.json (React Native)

## Build and Test Configuration

Code Connect files are automatically excluded from builds and tests:

- **TypeScript**: `tsconfig.packages.build.json` excludes `**/*.figma.tsx`
- **Jest Coverage**: `jest.config.js` ignores `\.figma\.tsx` files

No additional configuration needed when adding new `.figma.tsx` files.

## Verification Checklist

After creating/updating Code Connect files:

- [ ] `.figma.tsx` file colocated with component
- [ ] Eslint disable comment present (first line)
- [ ] Auto-generated comment included
- [ ] All imports correct (component, enums, React, figma)
- [ ] Enum values used in mappings (not string literals)
- [ ] Realistic example props provided
- [ ] All required props included in example
- [ ] Both React and React Native have Code Connect files
- [ ] Dry run passes: `yarn figma:connect:publish:dry-run`
- [ ] Successfully published: `yarn figma:connect:publish`
- [ ] Verified in Figma Dev Mode (platform dropdown, correct imports, code examples)

## References

- [Figma Code Connect Documentation](https://www.figma.com/code-connect-docs/)
- [Connecting React Components](https://www.figma.com/code-connect-docs/react/)
- [MetaMask Design System Figma File](https://www.figma.com/design/1D6tnzXqWgnUC3spaAOELN/%F0%9F%A6%8A-WIP--MMDS-Components)
- Initial setup guide: @docs/figma-code-connect.md
- Related cursor rules: @.cursor/rules/component-creation.md
