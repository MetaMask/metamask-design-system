# Figma Code Connect

Connect design system components to Figma for automatic code snippet display in Dev Mode.

**Note:** For initial setup (Figma token, environment configuration), see @docs/figma-code-connect.md

## Critical Rules

### File Location and Naming

- **ALWAYS** colocate `.figma.tsx` files with their components
- **ALWAYS** use naming convention: `ComponentName.figma.tsx`
- **ALWAYS** create Code Connect files for BOTH React and React Native platforms

```
// ✅ Correct file structure
src/components/
├── Button/
│   ├── Button.tsx
│   ├── Button.figma.tsx        ← React Code Connect
│   └── ...

packages/design-system-react/src/components/Button/Button.figma.tsx
packages/design-system-react-native/src/components/Button/Button.figma.tsx
```

### Required File Structure

- **ALWAYS** include eslint disable comment for 'figma' import (first line)
- **ALWAYS** include auto-generated comment documenting purpose
- **ALWAYS** import actual component and enums
- **ALWAYS** use figma.connect() with component, URL, props mapping, and example

```tsx
// ❌ Wrong - Missing eslint disable comment
import figma from '@figma/code-connect';
import React from 'react';
import { Button } from './Button';

// ✅ Correct - All required elements
// eslint-disable-next-line import-x/no-named-as-default
import figma from '@figma/code-connect';
import React from 'react';

import { Button } from './Button';
import { ButtonVariant, ButtonSize } from '.';

/**
 * -- This file was auto-generated by Code Connect --
 * React implementation of Button
 */

figma.connect(
  Button,
  'https://www.figma.com/design/[fileKey]/...?node-id=[nodeId]',
  {
    props: {
      // Property mappings
    },
    example: (props) => <Button {...props} />,
  },
);
```

### Prop Mapping - Use Enums, Not Strings

- **ALWAYS** import and use actual enum values in figma.enum mappings
- **NEVER** use string literals in enum mappings
- **ALWAYS** match Figma property names (left side) to enum values (right side)

```tsx
// ❌ Wrong - Using string literals
props: {
  variant: figma.enum('variant', {
    Primary: 'primary', // String literal
    Secondary: 'secondary', // String literal
  });
}

// ✅ Correct - Using imported enums
import { ButtonVariant } from '.';

props: {
  variant: figma.enum('variant', {
    Primary: ButtonVariant.Primary,
    Secondary: ButtonVariant.Secondary,
    Tertiary: ButtonVariant.Tertiary,
  });
}
```

### Realistic Example Props

- **ALWAYS** provide realistic, meaningful prop values in examples
- **ALWAYS** include all required props
- **NEVER** use placeholder values like "example", "test", or "foo"

```tsx
// ❌ Wrong - Placeholder values
example: (props) => <AvatarAccount address="0x123" {...props} />;

// ✅ Correct - Realistic address
example: (props) => (
  <AvatarAccount
    address="0x9Cbf7c41B7787F6c621115010D3B044029FE2Ce8"
    {...props}
  />
);
```

### Platform Consistency

- **ALWAYS** create Code Connect files for BOTH platforms when adding/updating components
- **ALWAYS** use similar examples across platforms
- **ALWAYS** use platform-specific package imports

```tsx
// ✅ React Web
import { Button } from './Button';
import { ButtonVariant, ButtonSize } from '.';
// Package: @metamask/design-system-react

// ✅ React Native
import { Button } from './Button';
import { ButtonVariant, ButtonSize } from '.';
// Package: @metamask/design-system-react-native
```

## Prop Mapping API

### Enum Mapping (Most Common)

Map Figma variants to TypeScript enum values:

```tsx
props: {
  variant: figma.enum('variant', {
    Primary: ButtonVariant.Primary,
    Secondary: ButtonVariant.Secondary,
    Tertiary: ButtonVariant.Tertiary,
  }),
  size: figma.enum('size', {
    Sm: ButtonSize.Sm,
    Md: ButtonSize.Md,
    Lg: ButtonSize.Lg,
  }),
}
```

### Boolean Mapping

Simple boolean properties:

```tsx
props: {
  isDisabled: figma.boolean('isDisabled'),
  isFullWidth: figma.boolean('isFullWidth'),
  isLoading: figma.boolean('isLoading'),
}
```

### String Mapping

Text content properties:

```tsx
props: {
  label: figma.string('label'),
  loadingText: figma.string('loadingText'),
}
```

### Boolean with Values

Conditional prop values based on boolean:

```tsx
props: {
  startIconName: figma.boolean('startIcon (Figma Only)', {
    true: IconName.Add,
    false: undefined,
  }),
}
```

### Nested Props

Map properties from nested Figma components:

```tsx
props: {
  buttonBase: figma.nestedProps('ButtonBase', {
    size: figma.enum('size', {
      Sm: ButtonSize.Sm,
      Md: ButtonSize.Md,
      Lg: ButtonSize.Lg,
    }),
    label: figma.string('label'),
    startIconName: figma.boolean('startIcon (Figma Only)', {
      true: IconName.Add,
      false: undefined,
    }),
  }),
}
```

### Conditional Nested Props

Nested props with conditional values:

```tsx
props: {
  loadingText: figma.nestedProps('_Loading Label', {
    text: figma.boolean('show loadingText', {
      true: figma.string('loadingText'),
      false: undefined,
    }),
  }),
}
```

## Example Patterns

### Simple Example (Static Props)

For components with minimal required props:

```tsx
example: (props) => (
  <AvatarAccount
    address="0x9Cbf7c41B7787F6c621115010D3B044029FE2Ce8"
    {...props}
  />
);
```

### Complex Example (Destructured Props)

For components with nested props or multiple variants:

```tsx
example: ({
  variant,
  buttonBase,
  isFullWidth,
  isLoading,
  isDisabled,
  isDanger,
  isInverse,
  loadingText,
  ...props
}) => (
  <Button
    variant={variant}
    size={buttonBase.size}
    isFullWidth={isFullWidth}
    isLoading={isLoading}
    loadingText={loadingText.text}
    isDisabled={isDisabled}
    isDanger={isDanger}
    isInverse={isInverse}
    startIconName={buttonBase.startIconName}
    endIconName={buttonBase.endIconName}
    {...props}
  >
    {buttonBase.label}
  </Button>
);
```

### Stateful Example (React Hooks)

For interactive components that need state:

```tsx
import { useState } from 'react';

example: ({ isDisabled, isInvalid, label, ...props }) => {
  const [isSelected, setIsSelected] = useState(false);
  return (
    <Checkbox
      id="checkbox-example"
      isSelected={isSelected}
      isDisabled={isDisabled}
      isInvalid={isInvalid}
      label={label.text}
      onChange={(prevState) => {
        setIsSelected(!prevState);
      }}
      {...props}
    />
  );
};
```

## Workflow

### Adding Code Connect to New Component

After creating a new component, add Code Connect:

```bash
# 1. Run interactive setup for the platform
yarn figma:connect:react              # For React Web
yarn figma:connect:react-native       # For React Native

# 2. Follow interactive wizard to:
#    - Select/search for your component in Figma
#    - Connect to the Figma node
#    - Generate .figma.tsx file

# 3. Review generated file and update:
#    - Replace string literals with enum values
#    - Add realistic example props
#    - Ensure all required props are included

# 4. Validate before publishing
yarn figma:connect:publish:dry-run

# 5. Publish to Figma
yarn figma:connect:publish
```

### Updating Existing Code Connect

When component props change:

```bash
# 1. Update .figma.tsx file manually with new props/mappings

# 2. Validate changes
yarn figma:connect:publish:dry-run

# 3. Republish
yarn figma:connect:publish
```

### Expected Results in Figma Dev Mode

After successful publishing:

- **Platform Dropdown**: Shows "React" and "React Native" options
- **Correct Imports**: Displays platform-specific package imports
- **Code Examples**: Shows component usage with realistic props and enum values

## Commands

```bash
# Interactive setup (add/update components)
yarn figma:connect:react              # React interactive wizard
yarn figma:connect:react-native       # React Native interactive wizard

# Publishing (automated)
yarn figma:connect:publish            # Publish all (React + React Native)
yarn figma:connect:publish:dry-run    # Validate all before publishing
yarn figma:connect:unpublish          # Unpublish all

# Platform-specific publishing
yarn figma:connect:publish:react                  # Publish React only
yarn figma:connect:publish:react-native           # Publish React Native only
yarn figma:connect:publish:react:dry-run          # Validate React only
yarn figma:connect:publish:react-native:dry-run   # Validate React Native only

# Platform-specific unpublishing
yarn figma:connect:unpublish:react           # Unpublish React
yarn figma:connect:unpublish:react-native    # Unpublish React Native
```

## Golden Path Examples

**Complete examples demonstrating best practices:**

- **Simple component**: @packages/design-system-react/src/components/AvatarAccount/AvatarAccount.figma.tsx
- **Complex component**: @packages/design-system-react/src/components/Button/Button.figma.tsx
- **Stateful component**: @packages/design-system-react/src/components/Checkbox/Checkbox.figma.tsx
- **React Native example**: @packages/design-system-react-native/src/components/Button/Button.figma.tsx

These examples show:

- Proper eslint disable comment
- Auto-generated comment
- Enum value usage (not strings)
- Realistic example props
- Nested props handling
- Stateful examples with hooks

**Configuration files:**

- @packages/design-system-react/figma.config.json (React Web config)
- @packages/design-system-react-native/figma.config.json (React Native config)

## Build and Test Configuration

Code Connect files are automatically excluded from builds and tests:

- **TypeScript**: `tsconfig.packages.build.json` excludes `**/*.figma.tsx`
- **Jest Coverage**: `jest.config.js` ignores `\.figma\.tsx` files

No additional configuration needed when adding new `.figma.tsx` files.

## Verification

After creating or updating Code Connect files, verify:

- [ ] `.figma.tsx` file colocated with component
- [ ] Eslint disable comment present (first line)
- [ ] Auto-generated comment included
- [ ] All imports correct (component, enums, React, figma)
- [ ] Enum values used in mappings (not string literals)
- [ ] Realistic example props provided
- [ ] All required props included in example
- [ ] Both React and React Native have Code Connect files
- [ ] Dry run passes: `yarn figma:connect:publish:dry-run`
- [ ] Successfully published: `yarn figma:connect:publish`
- [ ] Verified in Figma Dev Mode (platform dropdown, correct imports, code examples)

## References

- [Figma Code Connect Documentation](https://www.figma.com/code-connect-docs/)
- [Connecting React Components](https://www.figma.com/code-connect-docs/react/)
- [MetaMask Design System Figma File](https://www.figma.com/design/1D6tnzXqWgnUC3spaAOELN/%F0%9F%A6%8A-WIP--MMDS-Components)
- Initial setup guide: @docs/figma-code-connect.md
- Related cursor rules: @.cursor/rules/component-creation.md
